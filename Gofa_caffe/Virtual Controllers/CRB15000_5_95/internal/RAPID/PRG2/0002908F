MODULE Kcare_Latte_art
	
    !=================
    ! Main progress(?)
    !=================
    PROC main()
        Home;
        pickTool1;
        takePhinFromBase;
        grindCoffeeConicalBurr;
        returnPhinToBase;
        tampCoffeePowder;
        takePhinFromBase;
        putPhinIntoCoffeemaker;
        dropTool1;
        Pick_Tool2;
        pickCupEndpoint;
        putCupIntoCoffeemaker;
        Drop_Tool2;
        pickTool1;
        extractCoffee;
        dropTool1;
        Pick_Tool2;
        takeCupOutOfCoffeemaker;
        putInMilkPump;
        Move_C_R;
        pressMilkPumpLid;
        Move_C_L;
        Drop_Tool2;
        Pick_Tool3;
        stirMilk;
        Drop_Tool3;
        Pick_Tool2;
        takeOutOfMilkPump;
        dropCupEndpoint;
        Drop_Tool2;
        pickTool1;
        takePhinOutOfCoffeemaker;
        returnPhinToBase;
        dropTool1;
        Home;
    ENDPROC
    
    PROC Home()
        MoveJ Target_CupDetection10,v500,z100,tool0;
    ENDPROC
    
    
    !==================================
    ! Actions of phin base
    !==================================
    PROC takePhinFromBase()
        SetDO ABB_Scalable_IO_0_DO1,0;
        MoveJ Target_CoffeTG,v500,fine,Gripper_Tool\WObj:=wobj0;
        MoveL Target_50,v500,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Target_60,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        SetDO ABB_Scalable_IO_0_DO1,1;
        WaitTime 2;
        MoveL Target_70,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Target_CoffeTG,v500,fine,Gripper_Tool\WObj:=wobj0;
    ENDPROC
    
    PROC returnPhinToBase()
        SetDO ABB_Scalable_IO_0_DO1,1;
        MoveL Target_70,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Target_60,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        SetDO ABB_Scalable_IO_0_DO1,0;
        WaitTime 2;
        MoveL Target_50,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveJ Target_CoffeTG,v500,fine,Gripper_Tool;
    ENDPROC
    
    
    !================================================
    ! Grinding the coffee beans into coffee powder 
    !================================================
    PROC grindCoffeeConicalBurr()
        SetDO ABB_Scalable_IO_0_DO5,0;
        MoveJ Target_CoffeTG,v200,fine,Phin_Tool\WObj:=Workobject_Home_coffe;
        MoveJ Conial_Burr_10,v500,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_20,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        SetDO ABB_Scalable_IO_0_DO5,1;
        MoveJ Conial_Burr_Move,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Back,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Move,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Back,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_20,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Pitch_1,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Roll_1,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Pitch_2,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Roll_2,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Pitch_1,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Roll_1,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Pitch_2,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Roll_2,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Move,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Back,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Move,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Back,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Pitch_1,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Roll_1,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Pitch_2,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Roll_2,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Move,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Back,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Move,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveJ Conial_Burr_Back,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        SetDO ABB_Scalable_IO_0_DO5,0;
        MoveL Conial_Burr_20,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
        MoveL Conial_Burr_10,v50,fine,Phin_Tool\WObj:=Workobject_Conial_Burr;
		MoveL Target_CoffeTG,v200,fine,Phin_Tool\WObj:=Workobject_Home_coffe;
    ENDPROC
    
    
    !=======
    ! 
    !========
    PROC putPhinIntoCoffeemaker()
        SetDO ABB_Scalable_IO_0_DO1,1;
        MoveJ Target_CoffeTG,v500,z100,Gripper_Tool;
        MoveL Target_10,v500,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_20,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_30,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        SetDO ABB_Scalable_IO_0_DO1,0;
        WaitTime 2;
        MoveL Target_40,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_CoffeTG,v500,fine,Gripper_Tool;
    ENDPROC
    
    PROC takePhinOutOfCoffeemaker()
        SetDO ABB_Scalable_IO_0_DO1,0;
        MoveJ Target_CoffeTG,v500,fine,Gripper_Tool;
        MoveJ Target_40,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_30,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        SetDO ABB_Scalable_IO_0_DO1,1;
        WaitTime 2;
        MoveL Target_20,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_10,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_CoffeTG,v500,fine,Gripper_Tool;
    ENDPROC
    
    
    !========================================================
    ! Postion to pick up cup and drop down cup when finish
    !========================================================
    PROC pickCupEndpoint()
        MoveJ Table_cup_TG,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveJ Table_cup_10,v400,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveL Table_cup_20,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveL Table_cup_30,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveL Table_cup_40,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
    ENDPROC
    
    PROC dropCupEndpoint()
        MoveL Table_cup_40,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveL Table_cup_30,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveL Table_cup_20,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveL Table_cup_10,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveJ Table_cup_TG,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
    ENDPROC
    
    
    !==============================
    ! Go to coffee machine position
    !==============================
    PROC Made_Coffe()
        SetDO ABB_Scalable_IO_0_DO1,1;
        MoveJ Target_CoffeTG,v200,z100,Gripper_Tool;
        MoveJ Target_10,v500,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_20,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_30,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        SetDO ABB_Scalable_IO_0_DO1,0;
        WaitTime 2;
        MoveL Target_40,v200,fine,Phin_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_CoffeTG,v200,fine,Gripper_Tool;
    ENDPROC
    
    
    !=========================
    ! Turn the coffee maker on
    !=========================
    PROC extractCoffee()
        SetDO ABB_Scalable_IO_0_DO1,0;
        MoveJ Target_CoffeTG,v500,fine,Gripper_Tool\WObj:=wobj0;
        MoveJ Target_80,v500,fine,Gripper_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_81,v200,fine,Gripper_Tool\WObj:=Workobject_Machine_coffe;
        SetDO ABB_Scalable_IO_0_DO1,1;
        WaitTime 2;
        MoveL Target_82,v200,fine,Gripper_Tool\WObj:=Workobject_Machine_coffe;
        WaitTime 23;
        MoveL Target_81,v200,fine,Gripper_Tool\WObj:=Workobject_Machine_coffe;
        SetDO ABB_Scalable_IO_0_DO1,0;
        WaitTime 2;
        MoveJ Target_80,v200,fine,Gripper_Tool\WObj:=Workobject_Machine_coffe;
    ENDPROC
    
    
    !==========
    !
    !==========
    PROC tampCoffeePowder()
        SetDO ABB_Scalable_IO_0_DO1,0;
        MoveJ Pay_0,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveJ Pay_20,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_10,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        SetDO ABB_Scalable_IO_0_DO1,1;
        WaitTime 2;
        MoveL Pay_20,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_30,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_40,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_50,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_40,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_50,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_40,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_30,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_20,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_10,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        SetDO ABB_Scalable_IO_0_DO1,0;
        WaitTime 2;
        MoveL Pay_20,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveL Pay_0,v200,fine,Gripper_Tool\WObj:=Workobject_pickPhin;
        MoveJ Target_CoffeTG,v200,fine,Gripper_Tool\WObj:=Workobject_Home_coffe;
    ENDPROC
    
    
    !=============
    ! Coffeemaker 
    !=============
    PROC putCupIntoCoffeemaker()
        MoveL Target_CoffeTG,v500,fine,Gripper_Tool\WObj:=wobj0;
        MoveL Target_93,v200,fine,Cup_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_94,v100,fine,Cup_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_95,v100,fine,Cup_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_96,v200,fine,Cup_Tool\WObj:=Workobject_Machine_coffe;
    ENDPROC
    
    PROC takeCupOutOfCoffeemaker()
        MoveJ Target_CoffeTG,v500,fine,Gripper_Tool\WObj:=wobj0;
        MoveL Target_96,v200,fine,Cup_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_95,v50,fine,Cup_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_94,v50,fine,Cup_Tool\WObj:=Workobject_Machine_coffe;
        MoveL Target_93,v200,fine,Cup_Tool\WObj:=Workobject_Machine_coffe;
    ENDPROC
    
    
    !=====================
    ! Add milk into coffee
    !=====================
    PROC putInMilkPump()
        MoveJ Milk_40,v500,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_10,v100,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_20,v100,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_30,v200,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
    ENDPROC
    
    PROC takeOutOfMilkPump()
        MoveJ Table_cup_TG,v200,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveL Milk_40,v200,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_30,v500,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_20,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_10,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
    ENDPROC
    
    PROC pressMilkPumpLid()
        MoveL Press_Milk_30,v200,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_20,v200,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_10,v5,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_20,v50,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_10,v5,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_20,v50,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_10,v5,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_20,v50,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_20,v50,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_10,v5,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_20,v50,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_10,v5,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_20,v50,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_10,v5,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_20,v50,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Press_Milk_10,v5,fine,Cup_Tool\WObj:=Workobject_Milk;
    ENDPROC
    
    PROC stirMilk()
        SetDO ABB_Scalable_IO_0_DO1,0;
        MoveJ Stirring_Milk_20,v500,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Stirring_Milk_10,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        SetDO ABB_Scalable_IO_0_DO1,1;
        WaitTime 15;
        SetDO ABB_Scalable_IO_0_DO1,0;
        MoveL Stirring_Milk_20,v200,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
    ENDPROC
    
    PROC Move_C_L()
        MoveJ Milk_50_L,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_60_L,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveC Milk_70_L,Milk_80_L,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_90_L,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveJ Milk_TG,v500,fine,Cup_Tool\WObj:=Workobject_Milk;
    ENDPROC
    
    PROC Move_C_R()
        MoveJ Milk_TG,v500,fine,Cup_Tool\WObj:=Workobject_Milk;
        MoveL Milk_50_R,v500,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_60_R,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveC Milk_70_R,Milk_80_R,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
        MoveL Milk_90_R,v50,fine,Cup_Top_Tool\WObj:=Workobject_Milk;
    ENDPROC
    
    
    !=============
    ! 
    !=============
    PROC pickTool1()
        MoveJ Change1_10,v500,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_20,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        SetDO ABB_Scalable_IO_0_DO1,1;
        MoveL Change1_30,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_40,v500,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
    ENDPROC
    
    PROC dropTool1()
        SetDO ABB_Scalable_IO_0_DO1,1;
        MoveJ Change1_40,v500,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_30,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_20,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_10,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        SetDO ABB_Scalable_IO_0_DO1,0;
    ENDPROC
    
    
    !==============
    !
    !==============
    PROC Pick_Tool2()
        MoveJ Change2_10,v500,fine,Cup_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change2_20,v200,fine,Cup_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change2_30,v200,fine,Cup_Tool\WObj:=Workobject_Change_Staytion;
        MoveJ Change2_40,v500,fine,Cup_Tool\WObj:=Workobject_Change_Staytion;
    ENDPROC
    
    PROC Drop_Tool2()
        MoveJ Change2_40,v500,fine,Cup_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change2_30,v200,fine,Cup_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change2_20,v200,fine,Cup_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change2_10,v200,fine,Cup_Tool\WObj:=Workobject_Change_Staytion;
    ENDPROC
    
    
    !=================
    !
    !=================
    PROC Drop_Tool3()
        MoveJ Change3_40,v500,fine,Stirrng_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change3_30,v200,fine,Stirrng_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change3_20,v200,fine,Stirrng_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change3_10,v200,fine,Stirrng_Tool\WObj:=Workobject_Change_Staytion;
    ENDPROC
    
    PROC Pick_Tool3()
        SetDO ABB_Scalable_IO_0_DO1,0;
        MoveJ Change3_10,v200,fine,Stirrng_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change3_20,v200,fine,Stirrng_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change3_30,v200,fine,Stirrng_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change3_40,v500,fine,Stirrng_Tool\WObj:=Workobject_Change_Staytion;
    ENDPROC
    
    
    !===============
    !
    !=============
    PROC Washing_Phin()
        MoveL Target_CoffeTG,v100,fine,Phin_Tool\WObj:=wobj0;
        MoveJ washing_TG_10,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveL washing_TG_10_2,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveJ washing_TG_10_3,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveJ washing_TG_10_4,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveJ Washing_10,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveL Washing_20,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        SetDO ABB_Scalable_IO_0_DO7,1;
        SetDO ABB_Scalable_IO_0_DO8,1;
        MoveL Washing_30,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveL Washing_40,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        WaitTime 1;
        MoveL Washing_30,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveL Washing_40,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveL Washing_30,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        WaitTime 3;
        MoveJ Washing_20,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        SetDO ABB_Scalable_IO_0_DO7,0;
        WaitTime 0.5;
        SetDO ABB_Scalable_IO_0_DO8,0;
        MoveL Washing_60,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveL Washing_50,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveL Washing_60,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveL Washing_50,v100,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveJ Washing_10,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        WaitTime 5;
        MoveJ washing_TG_10_4,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveJ washing_TG_10_3,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        WaitTime 5;
        MoveJ washing_TG_10_2,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveJ washing_TG_10,v200,fine,Phin_Tool\WObj:=Workobject_Washing_Phin;
        MoveJ Target_CoffeTG,v200,fine,Phin_Tool\WObj:=wobj0;
    ENDPROC
    
    
    !===========
    !
    !===========
    PROC pickIce()
        MoveL Table_cup_TG,v100,fine,Cup_Tool\WObj:=Workobject_Table_Cup;
        MoveL Ice_10,v100,fine,Cup_Tool\WObj:=Workobject_Machine_Ice;
        MoveL Ice_20,v100,fine,Cup_Tool\WObj:=Workobject_Machine_Ice;
        MoveL Ice_30,v100,fine,Cup_Tool\WObj:=Workobject_Machine_Ice;
        SetDO ABB_Scalable_IO_0_DO6,1;
        WaitTime 1;
        SetDO ABB_Scalable_IO_0_DO6,0;
        WaitTime 3;
        MoveL Ice_20,v100,fine,Cup_Tool\WObj:=Workobject_Machine_Ice;
        MoveL Ice_10,v100,fine,Cup_Tool\WObj:=Workobject_Machine_Ice;
    ENDPROC
    
    
    !===========================
    ! Detect cup to trigger flag
    !===========================    
    PROC detectCup()
        MoveL capture_frame, v200, fine, Cup_Tool\WObj:=Workobject_Table_Cup;
        ! Reset cờ trước khi gọi
        detectCupFlag := FALSE;
    
        ! Gửi “lệnh chụp” cho app C#
        triggerDetect := TRUE;
    
        ! (khuyến nghị) đợi 1 chu kỳ nhỏ để C# poll kịp
        WaitTime 0.05;
    
        ! Chờ cho tới khi app C# trả cờ
        WaitUntil detectCupFlag;
    
        ! (tuỳ chọn) reset lại trigger ở RAPID (C# cũng đã reset)
        triggerDetect := FALSE;
    ENDPROC

    
    !========================================================
    ! Function to make coffee depend on selection of customer 
    !========================================================
    PROC BlackCoffee()             
        Home;
        pickTool1;
        takePhinFromBase;
        grindCoffeeConicalBurr;
        returnPhinToBase;
        tampCoffeePowder;
        takePhinFromBase;
        putPhinIntoCoffeemaker;
        dropTool1;
            
        Pick_Tool2;
        detectCup;
            
        IF detectCupFlag THEN
            pickCupEndpoint;
            putCupIntoCoffeemaker;
            Drop_Tool2;
            pickTool1;
            extractCoffee;
            dropTool1;
            Pick_Tool2;
            takeCupOutOfCoffeemaker;
            IF ice_checkbox THEN
                WaitTime 2;
                pickIce;
            ENDIF
            dropCupEndpoint;
            Drop_Tool2;
            pickTool1;
            takePhinOutOfCoffeemaker;
            returnPhinToBase;
            dropTool1;
            Home;
            detectCupFlag := FALSE;
        ENDIF
    ENDPROC
    
    PROC MilkCoffee()  
        Home;
        pickTool1;
        takePhinFromBase;
        grindCoffeeConicalBurr;
        returnPhinToBase;
        tampCoffeePowder;
        takePhinFromBase;
        putPhinIntoCoffeemaker;
        dropTool1;
        Pick_Tool2;
        pickCupEndpoint;
        putCupIntoCoffeemaker;
        Drop_Tool2;
        pickTool1;
        extractCoffee;
        dropTool1;
        Pick_Tool2;
        takeCupOutOfCoffeemaker;
        putInMilkPump;
        Move_C_R;
        pressMilkPumpLid;
        Move_C_L;
        Drop_Tool2;
        Pick_Tool3;
        stirMilk;
        Drop_Tool3;
        Pick_Tool2;
        takeOutOfMilkPump;
        IF ice_checkbox THEN
            WaitTime 2;
            pickIce;
        ENDIF
        dropCupEndpoint;
        Drop_Tool2;
        pickTool1;
        takePhinOutOfCoffeemaker;
        returnPhinToBase;
        dropTool1;
        Home;
    ENDPROC
    PROC Pick_Tool1()
        MoveJ Change1_10,v500,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_20,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        SetDO ABB_Scalable_IO_0_DO1,1;
        MoveL Change1_30,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_40,v500,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
    ENDPROC
    PROC Drop_Tool1()
        SetDO ABB_Scalable_IO_0_DO1,1;
        MoveJ Change1_40,v500,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_30,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_20,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        MoveL Change1_10,v200,fine,Gripper_Tool\WObj:=Workobject_Change_Staytion;
        SetDO ABB_Scalable_IO_0_DO1,0;
    ENDPROC
    PROC Caffee()
        Home;
        Pick_Tool1;
        Drop_Tool1;
        Pick_Tool2;
        Drop_Tool2;
        Pick_Tool1;
        Drop_Tool1;
        Pick_Tool2;
        Drop_Tool2;
        Pick_Tool1;
        Drop_Tool1;
        Home;
    ENDPROC
    PROC Caffee_Milk()
        Home;
        Pick_Tool1;
        Drop_Tool1;
        Pick_Tool2;
        Drop_Tool2;
        Pick_Tool1;
        Drop_Tool1;
        Pick_Tool2;
        Move_C_R;
        Move_C_L;
        Drop_Tool2;
        Pick_Tool3;
        Drop_Tool3;
        Pick_Tool2;
        Drop_Tool2;
        Pick_Tool1;
        Washing_Phin;
        Drop_Tool1;
        Home;
    ENDPROC
    PROC CupDetection()
        MoveL Target_CupDetection10,v50,fine,Gripper_Tool\WObj:=wobj0;
        MoveL Target_CupDetection20,v50,fine,Gripper_Tool\WObj:=wobj0;
        MoveL Target_CupDetection30,v50,fine,Gripper_Tool\WObj:=wobj0;
        MoveL Target_CupDetection10,v50,fine,Gripper_Tool\WObj:=wobj0;
    ENDPROC


ENDMODULE